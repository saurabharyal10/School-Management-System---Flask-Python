{% extends 'admin/admin_nav.html' %}
{% block content %}

<div class="container mt-5">
    <h2 class="text-center mb-4">Edit User: {{ user.full_name }}</h2>

    <form method="POST" enctype="multipart/form-data">
        <div class="row">
            <!-- Basic Fields -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Full Name</label>
                <input type="text" name="full_name" class="form-control" value="{{ user.full_name }}" required>
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">Username (read-only)</label>
                <input type="text" class="form-control" value="{{ user.username }}" readonly>
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">Address</label>
                <input type="text" name="address" class="form-control" value="{{ user.address }}">
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">Gender</label>
                <select name="gender" class="form-select">
                    <option value="Male" {% if user.gender=='Male' %}selected{% endif %}>Male</option>
                    <option value="Female" {% if user.gender=='Female' %}selected{% endif %}>Female</option>
                    <option value="Other" {% if user.gender=='Other' %}selected{% endif %}>Other</option>
                </select>
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">Role</label>
                <select name="role" class="form-select">
                    <option value="Student" {% if user.role=='Student' %}selected{% endif %}>Student</option>
                    <option value="Teacher" {% if user.role=='Teacher' %}selected{% endif %}>Teacher</option>
                </select>
            </div>

            <div class="col-md-6 mb-3">
                <label class="form-label">Date of Birth</label>
                <input type="date" name="dob" class="form-control"
                    value="{{ user.dob.strftime('%Y-%m-%d') if user.dob }}">
            </div>

            <!-- Qualification -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Qualification</label>
                <select name="qualification" id="qualification" class="form-select">
                    <option value="">-- Select --</option>
                    <option value="SEE" {% if user.qualification=='SEE' %}selected{% endif %}>SEE</option>
                    <option value="12th" {% if user.qualification=='12th' %}selected{% endif %}>12th</option>
                    <option value="Bachelor" {% if user.qualification=='Bachelor' %}selected{% endif %}>Bachelor
                    </option>
                    <option value="Master" {% if user.qualification=='Master' %}selected{% endif %}>Master</option>
                    <option value="Other" {% if user.qualification=='Other' %}selected{% endif %}>Other</option>
                </select>
            </div>

            <div class="col-md-6 mb-3" id="otherQualificationDiv" style="display: none;">
                <label class="form-label">Other Qualification</label>
                <input type="text" name="other_qualification" class="form-control"
                    value="{{ user.other_qualification }}">
            </div>

            <!-- Document Type -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Document Type</label>
                <select name="documentType" id="documentType" class="form-select">
                    <option value="Citizenship" {% if user.document_type=='Citizenship' %}selected{% endif %}>
                        Citizenship</option>
                    <option value="Passport" {% if user.document_type=='Passport' %}selected{% endif %}>Passport
                    </option>
                    <option value="License" {% if user.document_type=='License' %}selected{% endif %}>License</option>
                    <option value="Other" {% if user.document_type=='Other' %}selected{% endif %}>Other</option>
                </select>
            </div>

            <div class="col-md-6 mb-3" id="otherDocumentDiv" style="display: none;">
                <label class="form-label">Other Document</label>
                <input type="text" name="otherDocument" class="form-control" value="{{ user.other_document }}">
            </div>

            <!-- Profile Photo Preview + Upload -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Current Profile Photo</label><br>
                {% if user.profile_image %}
                <a href="{{ url_for('static', filename='images/' ~ user.profile_image) }}" target="_blank">
                    <img src="{{ url_for('static', filename='images/' ~ user.profile_image) }}"
                        class="img-thumbnail mb-2" style="height: 80px; cursor: pointer;">
                </a>
                {% else %}
                <p class="text-muted">No photo uploaded.</p>
                {% endif %}
                <input type="file" name="profile_photo" class="form-control mt-2">
            </div>


            <!-- Document File Preview + Upload -->
            <div class="col-md-6 mb-3">
                <label class="form-label">Uploaded Document</label><br>
                {% if user.document_filename %}
                <a href="{{ url_for('static', filename='uploads/' + user.document_filename) }}" target="_blank">
                    View Document
                </a>
                {% else %}
                <p class="text-muted">No document uploaded.</p>
                {% endif %}
                <input type="file" name="documentFile" class="form-control mt-2">
            </div>

            <!-- Notes -->
            <div class="col-md-12 mb-3">
                <label class="form-label">Notes</label>
                <textarea name="notes" rows="3" class="form-control">{{ user.notes }}</textarea>
            </div>
        </div>

        <div class="text-center">
            <a href="{{ url_for('admin.list_users', role=user.role.lower()) }}" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-success">Save Changes</button>
        </div>
    </form>
</div>

<script>
    // Handle dynamic display of "Other Qualification" field
    const qualificationSelect = document.getElementById('qualification');
    const otherQualificationDiv = document.getElementById('otherQualificationDiv');
    qualificationSelect.addEventListener('change', () => {
        otherQualificationDiv.style.display = qualificationSelect.value === 'Other' ? 'block' : 'none';
    });
    if (qualificationSelect.value === 'Other') {
        otherQualificationDiv.style.display = 'block';
    }

    // Handle dynamic display of "Other Document" field
    const docTypeSelect = document.getElementById('documentType');
    const otherDocDiv = document.getElementById('otherDocumentDiv');
    docTypeSelect.addEventListener('change', () => {
        otherDocDiv.style.display = docTypeSelect.value === 'Other' ? 'block' : 'none';
    });
    if (docTypeSelect.value === 'Other') {
        otherDocDiv.style.display = 'block';
    }
</script>

{% endblock %}